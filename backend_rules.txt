# project_rules

Adding file with project for clean project

---

## Swagger Documentation Rules

1. Every new route, controller, service, or endpoint added to the backend must include
   a corresponding Swagger documentation file inside the folder: `./Docs`

2. Swagger docs must follow these standards:

   * File name must match the route or module (e.g., `user.routes` → `Docs/user/getuserdata_endpoint.js`).
   * Use OpenAPI 3.0 format.
   * Include: summary, description, parameters, requestBody, responses, and security.
   * Responses must include success (200/201) and error schemas (400/401/404/500).

3. No endpoint is considered **complete** unless:

   * Controller is implemented
   * Validator is included
   * Route is created
   * Swagger doc file exists inside `./Docs`
   * Swagger file is properly linked to the global swagger loader

4. Folder Structure Standard:

```
./Docs/
  user/
    getuserdata_endpoint.js
  auth/
    login_endpoint.js
    register_endpoint.js
  product/
    getproduct_endpoint.js
    newproduct_endpoint.js
  listing/
    ...
```

5. If an endpoint is updated, the Swagger documentation **must also be updated**.

6. The AI must automatically generate Swagger documentation for any code it produces and place it in the correct `Docs/` path.

---

## 1. Core Architecture Rules

* Follow **MVC + Service + Repository** pattern
* Strict separation of concerns:

| Layer        | Responsibility                          |
| ------------ | --------------------------------------- |
| Routes       | Define endpoints only                   |
| Controllers  | Receive request, validate, call service |
| Services     | Business logic                          |
| Repositories | Database operations                     |
| Models       | Schema only                             |

* No module should depend on files outside its layer

---

## 2. File Size & Function Size Rules

* Max **100 lines per file**
* Max **20 lines per function**
* Controllers must be **≤20 lines**

If logic exceeds limits:

* Split into helpers or smaller services
* Do NOT compress logic into unreadable code

---

## 3. Folder Structure Rules

```
src/
  routes/
    user/
      userRoutes.js
  controllers/
    user/
      signupController.js
      loginController.js
      verifyOtpController.js
      forgotPasswordController.js
      resetPasswordController.js
  services/
    user/
      signupService.js
      loginService.js
      verifyOtpService.js
      forgotPasswordService.js
      resetPasswordService.js
  repositories/
    user/
      userRepository.js
  models/
    userModel.js
  validators/
    user/
      signupValidator.js
      loginValidator.js
  middlewares/
    authMiddleware.js
  utils/
    hashPassword.js
    comparePassword.js
    generateToken.js
    sendEmail.js
```

---

## 4. Routing Rules

* Routes must ONLY map endpoints → controllers
* No logic inside route files
* Each domain has its own route folder

Example:

```js
router.post('/signup', signupController);
router.post('/login', loginController);
```

---

## 5. Controller Rules

Controllers must:

* Be **5–20 lines**
* Handle request + response only
* Call a service
* Use try/catch
* Return standard JSON

Controllers must NOT:

* Contain business logic
* Contain DB queries

---

## 6. Service Rules

* Contain business logic only
* Max **20–25 lines**
* Must NOT access `req` / `res`
* Must NOT return HTTP responses
* Call repositories for DB
* Throw errors instead of handling responses

---

## 7. Repository Rules

* Handle all DB operations
* Interact only with models
* No validation
* No business logic

---

## 8. MongoDB / Mongoose Rules

* Models define schema only
* No business logic in models
* Use repositories for DB operations

---

## 9. Validation Rules

* All validation lives in `validators/`
* Never validate in controllers or services
* Use Joi / Yup / custom validators

---

## 10. Naming Rules

* Filenames must reflect responsibility
* Descriptive and explicit naming

---

## 11. API Response Rules

Always return:

```json
{
  "success": true,
  "message": "",
  "data": {}
}
```

---

## 12. Security Rules

* Hash passwords
* Never return sensitive data
* Use Helmet, CORS, Rate Limit
* Load secrets from `.env`

---

## 13. Error Handling Rules

* Services throw errors
* Controllers catch errors
* Standard error response

---

## 14. Middleware Rules

* Auth logic only in `middlewares/`
* <30 lines
* No business logic
* Must call `next()`

---

## 15. Code Generation Rules for AI

* Follow all rules strictly
* Split logic automatically
* Never mix layers
* No long files or functions

---

## 16. Example Workflow

Signup API must include:

* signupController.js
* signupService.js
* signupValidator.js
* Swagger doc

---

## 17. Script Rules

* Temporary scripts must be created in `./Script`
* Must be deleted after task completion

---

## 18. Environment & Cost Control Rules (NEW)

* Every cost-generating service must support **dev/prod toggle**
* Use feature flags:

  * `USE_REDIS`
  * `USE_WORKERS`
  * `ENABLE_CRON`

Rules:

* Redis, queues, workers must be **OFF in development**
* Production services must never run by default
* Environment-based initialization only
* No service should connect unless explicitly enabled

---

## 19. Change Stability & Partner Safety Rules (NEW)

* Once an API contract is exposed to frontend or partners:

  * Do NOT change response structure
  * Do NOT change data types
  * Do NOT switch object ↔ array

If change is necessary when:
i ask you to add this thing in api like add a new variable etc


---

## 20. General Clean Code Principles

* Single Responsibility Principle
* No duplicate logic
* Small reusable helpers
* Predictable behavior
* Consistent formatting

 22. Configuration Management Rules (NEW)
   * All configuration should be stored in ./src/config/ directory
   * Create separate config files for different concerns:
     - db.js - Database connection settings
     - config.js - General application configuration
     - environment.js - Environment-specific settings
     - utils.js - Utility configurations (password hashing, JWT, etc.)
   * Never hardcode configuration values in application logic
   * Use environment variables for sensitive data
   * Create environment-specific configurations (dev, prod, test)
   * Centralize configuration imports to make them easily manageable
   * Use configuration validation to ensure required values are present

  23. Environment Variables Management Rules (NEW)
   * All environment variables must be defined in .env file
   * Create a .env.example file with all required variables (without values)
   * Never commit .env file to version control
   * Use descriptive names for environment variables
   * Group related variables with comments in the .env file
   * Always provide fallback values for environment variables in the code

  24. Swagger Documentation Enhancement Rules (NEW)
   * All Swagger documentation files must be referenced in the main swagger config
   * Use swagger-jsdoc to automatically generate documentation from JSDoc comments
   * Update swagger config file to include new documentation files when added
   * Ensure all API endpoints have corresponding Swagger documentation
   * Test Swagger documentation after adding new endpoints
   * Use consistent tags across all documentation files

  25. Dependency Management Rules (NEW)
   * All dependencies should be properly listed in package.json
   * Use semantic versioning for dependencies
   * Separate production and development dependencies appropriately
   * Keep dependencies updated but test thoroughly after updates
   * Document any custom or non-standard dependencies in the README

  26. Error Handling Consistency Rules (NEW)
   * All API responses must follow the standard format: {success, message, data}
   * Error messages should be user-friendly and not expose internal details
   * Implement centralized error handling middleware
   * Log errors appropriately but don't expose sensitive information in responses
   * Use appropriate HTTP status codes (200, 201, 400, 401, 404, 500)
